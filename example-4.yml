name: Event pump to SQL
source: ../events/roles.seed.json
patterns:
  - name: roleCreate
    rule:
      noun: role
      verb: create
    action:
      target: sql
      params:
        sql: >
          INSERT INTO tbl_roles
          ([ID], [RoleName], [OrganisationID],[Allow])
          VALUES (@ID, @RoleName, @OrganisationID, @Allow)
        input:
          - name: "ID"
            type: "UNIQUEIDENTIFIER"
            value: "{{id}}"
          - name: "RoleName"
            type: "NVARCHAR(50)"
            value: "{{roleName}}"
          - name: "Allow"
            type: "NVARCHAR(MAX)"
            value: "{{allow}}"
          - name: "OrganisationID"
            type: "UNIQUEIDENTIFIER"
            value: "{{organisationId}}"  
  - name: roleUpdate
    rule:
      noun: role
      verb: update
    action:
      target: sql
      params:
        sql: >          
            UPDATE tbl_roles SET 
            {{#if roleName}}
              [RoleName] = @RoleName,
            {{/if}}
            {{#if allow}}
              [Allow] = @Allow,
            {{/if}}
            {{#if organisationId}}
              [OrganisationID] = @OrganisationID,
            {{/if}}
            WHERE [ID] = @ID          
        input:
          - name: "ID"
            type: "UNIQUEIDENTIFIER"
            value: "{{id}}"
          - name: "RoleName"
            type: "NVARCHAR(50)"
            value: "{{roleName}}"
          - name: "Allow"
            type: "NVARCHAR(MAX)"
            value: "{{allow}}"
          - name: "OrganisationID"
            type: "UNIQUEIDENTIFIER"
            value: "{{organisationId}}"
      # id: "{{id}}"
      # sql:
      #   - "UPDATE tbl_roles SET "
      #   - split: ","
      #     list:
      #     - "[RoleName] = {{roleName}}"
      #     - "[Allow] = {{allow}}"
      #   - "WHERE [ID] = {{id}}"
      # sql: "UPDATE tbl_roles SET [Field1] = {{value1}}, ... WHERE [ID] = {{id}}"

  # - name: roleDelete
  #   rule:
  #     noun: role
  #     verb: create
  #   action:
  #     target: sql
  #     params:
  #       id: "{{id}}"
        # sql: "DELETE FROM tbl_roles WHERE '{values}}'"


        # sql: "INSERT INTO tbl_roles ([RoleName], [Allow]) VALUES('{{roleName}}','{{allow}}')"
        # input:
        #   - name: "role"
        #     type: "NVARCHAR(50)"
        #     value: "{{role}}"
        #   - name: "allow"
        #     type: "NVARCHAR(MAX)"
        #     value: "{{allow}}"
        # output:
        #   - name: "id"
        #     type: "UNIQUEIDENTIFIER"